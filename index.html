<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Wywoływacz Numeru Zamówienia</title>
    <style>
        body {
            padding-top: 60px;
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        .menu-bar {
            background-color: #007bff;
            color: white;
            padding: 10px 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-size: 150%;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .menu-bar a {
            color: white;
            text-decoration: none;
            padding: 0 20px;
        }

        .menu-bar a:hover {
            text-decoration: underline;
        }

        input[type=text] {
            font-size: 200%;
            padding: 10px;
            margin-bottom: 10px;
            width: 80%;
        }

        input[readonly] {
            background-color: #e9ecef;
            cursor: not-allowed;
        }

        button {
            font-size: 200%;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .keyboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 2cm;
        }

        .form-container {
            width: 20%;
            padding: 20px;
            border: 2px solid #ccc;
            border-radius: 10px;
            background-color: #f9f9f9;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: inline-block;
            vertical-align: top;
            height: 70%;
            margin-top: 2cm;
            position: absolute;
            top: 30px;
            left: 70px;
        }

        .form-container button {
            width: 100%;
            display: block;
            margin-top: 10px;
        }

        .green-button {
            background-color: #28a745;
        }

        .green-button:hover {
            background-color: #218838;
        }

        .red-button {
            background-color: #ff4d4d;
        }

        .red-button:hover {
            background-color: #e60000;
        }

        .right-container {
            width: 40%;
            display: inline-block;
            padding: 10px;
            margin-left: 50%;
            border: 2px solid #ccc;
            border-radius: 10px;
            background-color: #f2f2f0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            vertical-align: top;
            height: 100%;
            overflow-y: auto;
        }

        .right-container h3 {
            text-align: center;
            color: #ff0000;
        }

        .order-list {
            margin-top: 20px;
            max-height: 70%;
            overflow-y: auto;
            border-top: 2px solid #ccc;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 5px;
            border-bottom: 2px solid #ddd;
            font-size: 170%;
        }

        .order-item button {
            font-size: 100%;
            background-color: #0f9403;
            color: white;
            padding: 5px 10px;
        }

        .order-item button:hover {
            background-color: #000000;
        }

        .enter-button {
            background-color: #007bff;
            color: white;
            font-size: 150%;
            border-radius: 5px;
            grid-column: span 3;
            margin-left: 10px;
            width: 100%;
        }

        .enter-button:hover {
            background-color: #28a745;
        }

        #imageInput {
            display: none;
        }

        .resize-bar {
            background-color: #000000;
            width: 20px;
            height: 20px;
            cursor: move;
            position: absolute;
            bottom: 0;
            right: 0;
            z-index: 1000;
        }

        .flash {
            animation: flash 1s ease-in-out;
        }

        @keyframes flash {
            0%, 100% { background-color: #dedcca; }
            50% { background-color: #fff176; }
        }

        @media (max-width: 768px) {
            .form-container, .right-container {
                width: 100%;
                margin-left: 0;
                position: static;
            }
        }
    
.dropdown {
    position: relative;
    display: inline-block;
}

.dropbtn {
    background-color: #007bff;
    color: white;
    font-size: 150%;
    border: none;
    cursor: pointer;
    padding: 10px 20px;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #007bff;
    min-width: 160px;
    z-index: 1;
    flex-direction: column;
}

.dropdown-content a {
    color: white;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
}

.dropdown-content a:hover {
    background-color: #0056b3;
}

.dropdown:hover .dropdown-content {
    display: block;
}


@media screen and (max-width: 768px) {
    .form-container, .right-container {
        width: 100% !important;
        margin: 0 auto !important;
        position: static !important;
        height: auto !important;
        box-sizing: border-box;
    }

    .container {
        flex-direction: column !important;
        padding: 10px;
    }

    .keyboard {
        grid-template-columns: repeat(3, 1fr) !important;
        margin-top: 1em !important;
    }

    .menu-bar {
        flex-direction: column !important;
        font-size: 130% !important;
        padding: 5px 0 !important;
    }

    .dropbtn {
        width: 100% !important;
        text-align: left;
    }

    .dropdown-content {
        width: 100% !important;
        position: static !important;
    }

    .order-item {
        flex-direction: column !important;
        font-size: 140% !important;
    }

    .order-item button {
        width: 100% !important;
        margin: 5px 0 !important;
    }

    input[type="text"] {
        width: 100% !important;
        font-size: 180% !important;
    }

    button.enter-button {
        font-size: 130% !important;
    }
}


.menu-icon {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 1001;
}

.hamburger {
    color: #007bff;
    background-color: transparent;
    border: none;
    font-size: 30px;
    cursor: pointer;
}

.menu-popup {
    display: none;
    position: absolute;
    background-color: #007bff;
    border-radius: 5px;
    min-width: 160px;
    box-shadow: 0px 4px 8px rgba(0,0,0,0.2);
}

.menu-popup a {
    color: white;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
}

.menu-popup a:hover {
    background-color: #0056b3;
}

</style>
</head>
<body>

<div class="menu-icon">
  <button class="hamburger" onclick="toggleMenu()">☰</button>
  <div class="menu-popup" id="menuPopup">
    <a href="#">menu1</a>
    <a href="#" onclick="document.getElementById('mp3FolderInput').click();">Ustaw folder MP3</a>
    <a href="#">menu3</a>
    <a href="#" id="openWindowLink">OTWÓRZ OKNO KLIENTA</a>
    <a href="#" onclick="document.getElementById('imageInput').click();">ZMIEŃ TŁO</a>
  </div>
  <input type="file" id="imageInput" accept="image/jpeg" onchange="zmienTlo(event)" style="display:none" />
</div>



</div>
<input type="file" id="imageInput" accept="image/jpeg" onchange="zmienTlo(event)" style="display:none" />
</div>

<div class="container">
    <form id="formularzZamowienia" onsubmit="event.preventDefault(); wywolajZamowienie('numer_zam1');">
        <div class="form-container" id="formContainer">
            <label for="numer_zam1">NUMER ZAMÓWIENIA:</label><br />
            <input type="text" id="numer_zam1" name="numer_zam" readonly /><br />
            <button type="button" class="green-button enter-button" onclick="wywolajZamowienie('numer_zam1')">ZAWOŁAJ</button>

            <div class="keyboard">
                <button type="button" onclick="dodajCyfre('numer_zam1', '7')">7</button>
                <button type="button" onclick="dodajCyfre('numer_zam1', '8')">8</button>
                <button type="button" onclick="dodajCyfre('numer_zam1', '9')">9</button>
                <button type="button" onclick="dodajCyfre('numer_zam1', '4')">4</button>
                <button type="button" onclick="dodajCyfre('numer_zam1', '5')">5</button>
                <button type="button" onclick="dodajCyfre('numer_zam1', '6')">6</button>
                <button type="button" onclick="dodajCyfre('numer_zam1', '1')">1</button>
                <button type="button" onclick="dodajCyfre('numer_zam1', '2')">2</button>
                <button type="button" onclick="dodajCyfre('numer_zam1', '3')">3</button>
                <button type="button" class="red-button" onclick="dodajCyfre('numer_zam1', 'C')">C</button>
                <button type="button" onclick="dodajCyfre('numer_zam1', '0')">0</button>
                <button type="button" onclick="usunCyfre('numer_zam1')">←</button>
            </div>
            <div class="resize-bar" id="resizeBar"></div>
        </div>
    </form>

    <div class="right-container">
        <h3>LISTA WYWOŁANYCH ZAMOWIEŃ</h3>
        <div id="orderList" class="order-list"></div>
        <button onclick="resetujListe()" class="red-button">WYCZYŚĆ LISTĘ</button>
    </div>
</div>

<script>
    let orders = JSON.parse(localStorage.getItem('orders')) || [];
    let newWindow = null;
let timers = [];

    function dodajCyfre(poleId, cyfra) {
        let pole = document.getElementById(poleId);
        if (cyfra === 'C') {
            pole.value = '';
        } else {
            pole.value += cyfra;
        }
    }

    function usunCyfre(poleId) {
        let pole = document.getElementById(poleId);
        pole.value = pole.value.slice(0, -1);
    }

    function wywolajZamowienie(poleId) {
        let numer = document.getElementById(poleId).value.trim();
        if (!numer || isNaN(numer)) {
            alert("Wprowadź prawidłowy numer zamówienia.");
            return;
        }

        if (orders.some(o => o.numer === numer)) {
            alert("Ten numer już został wywołany.");
            return;
        }

        let dzwiek = mp3Files[numer] ? new Audio(mp3Files[numer]) : new Audio(numer + ".mp3"); // przywrócona domyślna ścieżka
        dzwiek.onerror = () => alert("Nie znaleziono pliku dźwiękowego dla numeru: " + numer);
        dzwiek.play();

        orders.push({ numer: numer, czas: Date.now() }); // dodaj jako string, nie jako obiekt!
        localStorage.setItem('orders', JSON.stringify(orders));
        updateOrderList();
    setInterval(updateOrderList, 1000);
        document.getElementById(poleId).value = '';
    }

    function updateOrderList() {
        let orderListElement = document.getElementById('orderList');
        orderListElement.innerHTML = '';

        orders.forEach((order, index) => {
        let item = document.createElement('div');
        item.classList.add('order-item');
        item.innerHTML = `<span>${order.numer}</span><br><span id="timer-${index}">Czas oczekiwania: 0m 0s</span>
            <button onclick="potwierdzOdbior(${index})">POTWIERDŹ<br>ODBIÓR</button>
            <button onclick="zawolajPonownie('${order.numer}')">ZAWOŁAJ<br>PONOWNIE</button>`;
        orderListElement.appendChild(item);
    });

        orderListElement.scrollTop = orderListElement.scrollHeight;
    updateTimers();

        if (newWindow && !newWindow.closed) {
            newWindow.updateOrderList(orders);
        }
    }

    function potwierdzOdbior(index) {
        orders.splice(index, 1);
        localStorage.setItem('orders', JSON.stringify(orders));
        updateOrderList();
    setInterval(updateOrderList, 1000);
    }

    function zawolajPonownie(numer) {
        let dzwiek = mp3Files[numer] ? new Audio(mp3Files[numer]) : new Audio(numer + ".mp3");
        dzwiek.onerror = () => alert("Nie znaleziono pliku dźwiękowego dla numeru: " + numer);
        dzwiek.play();
    }

    function zmienTlo(event) {
        let file = event.target.files[0];
        if (file && file.type === "image/jpeg") {
            let reader = new FileReader();
            reader.onload = (e) => {
                document.body.style.backgroundImage = `url(${e.target.result})`;
            };
            reader.readAsDataURL(file);
        } else {
            alert("Proszę wybrać plik JPEG.");
        }
    }

    function otworzOkno() {
        if (newWindow && !newWindow.closed) {
            newWindow.focus();
            return;
        }

        newWindow = window.open("", "Okno Klienta", "width=768,height=1024");
        newWindow.document.write(`
            <html>
            <head><title>Okno Klienta</title>
            <style>
                body { font-size: 150%; background-color: #f0f0f0; }
                h2 { font-weight: bold; font-size: 150%; }
                .order-item {
                    font-size: 300%;
                    font-weight: bold;
                    color: #0249a1;
                    background-color: #dedcca;
                    padding: 10px;
                    border-radius: 5px;
                }
            
.dropdown {
    position: relative;
    display: inline-block;
}

.dropbtn {
    background-color: #007bff;
    color: white;
    font-size: 150%;
    border: none;
    cursor: pointer;
    padding: 10px 20px;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #007bff;
    min-width: 160px;
    z-index: 1;
    flex-direction: column;
}

.dropdown-content a {
    color: white;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
}

.dropdown-content a:hover {
    background-color: #0056b3;
}

.dropdown:hover .dropdown-content {
    display: block;
}


@media screen and (max-width: 768px) {
    .form-container, .right-container {
        width: 100% !important;
        margin: 0 auto !important;
        position: static !important;
        height: auto !important;
        box-sizing: border-box;
    }

    .container {
        flex-direction: column !important;
        padding: 10px;
    }

    .keyboard {
        grid-template-columns: repeat(3, 1fr) !important;
        margin-top: 1em !important;
    }

    .menu-bar {
        flex-direction: column !important;
        font-size: 130% !important;
        padding: 5px 0 !important;
    }

    .dropbtn {
        width: 100% !important;
        text-align: left;
    }

    .dropdown-content {
        width: 100% !important;
        position: static !important;
    }

    .order-item {
        flex-direction: column !important;
        font-size: 140% !important;
    }

    .order-item button {
        width: 100% !important;
        margin: 5px 0 !important;
    }

    input[type="text"] {
        width: 100% !important;
        font-size: 180% !important;
    }

    button.enter-button {
        font-size: 130% !important;
    }
}


.menu-icon {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 1001;
}

.hamburger {
    color: #007bff;
    background-color: transparent;
    border: none;
    font-size: 30px;
    cursor: pointer;
}

.menu-popup {
    display: none;
    position: absolute;
    background-color: #007bff;
    border-radius: 5px;
    min-width: 160px;
    box-shadow: 0px 4px 8px rgba(0,0,0,0.2);
}

.menu-popup a {
    color: white;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
}

.menu-popup a:hover {
    background-color: #0056b3;
}

</style></head>
            <body>

<div class="menu-icon">
  <button class="hamburger" onclick="toggleMenu()"></button>
  <div class="menu-popup" id="menuPopup">
    <a href="#">menu1</a>
    <a href="#" onclick="document.getElementById('mp3FolderInput').click();">Ustaw folder MP3</a>
    <a href="#">menu3</a>
    <a href="#" id="openWindowLink">OTWÓRZ OKNO KLIENTA</a>
    <a href="#" onclick="document.getElementById('imageInput').click();">ZMIEŃ TŁO</a>
  </div>
  <input type="file" id="imageInput" accept="image/jpeg" onchange="zmienTlo(event)" style="display:none" />
</div>

                <h2>TWOJE ZAMÓWIENIE JEST GOTOWE DO ODBIORU</h2>
                <div id="orderList"></div>
            
<input type="file" id="mp3FolderInput" accept=".mp3" multiple style="display:none" />

</body>
            </html>
        `);

        
newWindow.updateOrderList = function(orders) {
    let list = newWindow.document.getElementById('orderList');
    list.innerHTML = '';
    orders.forEach(order => {
        let item = newWindow.document.createElement('div');
        item.className = 'order-item';
        item.innerHTML = `<b>${order.numer}</b>`;
        list.appendChild(item);
    });
};


        newWindow.updateOrderList(orders);
    }

    document.getElementById('openWindowLink').addEventListener('click', otworzOkno);

    // obsługa przeciągania
    const resizeBar = document.getElementById('resizeBar');
    const formContainer = document.getElementById('formContainer');
    let isDragging = false, offsetX = 0, offsetY = 0;

    resizeBar.addEventListener('mousedown', function(e) {
        isDragging = true;
        offsetX = e.clientX - formContainer.offsetLeft;
        offsetY = e.clientY - formContainer.offsetTop;
        document.body.style.cursor = 'move';
    });

    document.addEventListener('mousemove', function(e) {
        if (isDragging) {
            formContainer.style.left = `${e.clientX - offsetX}px`;
            formContainer.style.top = `${e.clientY - offsetY}px`;
        }
    });

    document.addEventListener('mouseup', function() {
        isDragging = false;
        document.body.style.cursor = 'default';
    });

    // obsługa klawiatury fizycznej
    document.addEventListener('keydown', function(e) {
        const pole = document.getElementById('numer_zam1');
        if (!isNaN(e.key)) {
            pole.value += e.key;
        } else if (e.key === 'Backspace') {
            pole.value = pole.value.slice(0, -1);
        } else if (e.key === 'Escape') {
            pole.value = '';
        } else if (e.key === 'Enter') {
            wywolajZamowienie('numer_zam1');
        }
    });

    function resetujListe() {
        if (confirm("Czy na pewno chcesz wyczyścić listę zamówień?")) {
            orders = [];
            localStorage.removeItem('orders');
            updateOrderList();
    setInterval(updateOrderList, 1000);
        }
    }

    updateOrderList();
    setInterval(updateOrderList, 1000);

function toggleMenu() {
    const popup = document.getElementById("menuPopup");
    popup.style.display = popup.style.display === "block" ? "none" : "block";
}


let mp3Files = {};

document.getElementById('mp3FolderInput').addEventListener('change', function(event) {
    mp3Files = {};
    for (let file of event.target.files) {
        let name = file.name.replace('.mp3', '');
        mp3Files[name] = URL.createObjectURL(file);
    }
    alert("Załadowano " + Object.keys(mp3Files).length + " plików mp3.");
});


function updateTimers() {
    timers.forEach(t => clearTimeout(t));
    timers = [];
    orders.forEach((order, index) => {
        const start = new Date(order.czas);
        const timerEl = document.getElementById(`timer-${index}`);
        if (!timerEl) return;
        function refresh() {
            let diff = Math.floor((Date.now() - start.getTime()) / 1000);
            let min = Math.floor(diff / 60);
            let sec = diff % 60;
            timerEl.textContent = `${min}m ${sec}s`;
            timers[index] = setTimeout(refresh, 1000);
        }
        refresh();
    });
}

</script>

<input type="file" id="mp3FolderInput" accept=".mp3" multiple style="display:none" />

</body>
</html>